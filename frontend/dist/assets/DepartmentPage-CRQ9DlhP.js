import{j as e,r as c,d as I,I as P,B as S}from"./index-D0kGtGIa.js";import{P as X,T as z,M as _,v as $}from"./Modal-BUDUBpVK.js";import{E as Q,d as N}from"./departmentsService-CqHIOhxl.js";import{S as A}from"./Select-BeY_WEo1.js";import{E as W}from"./EmployeesListModal-BT8Rncgf.js";const q=["bg-indigo-100 text-indigo-600","bg-sky-100 text-sky-600","bg-emerald-100 text-emerald-600","bg-violet-100 text-violet-600","bg-amber-100 text-amber-600"],Z=m=>m?m.split(" ").map(o=>o.charAt(0)).join("").slice(0,2).toUpperCase():"?",ee=(m,o)=>{if(o<=5)return Array.from({length:o},(g,p)=>p+1);const r=[1];let s=Math.max(2,m-1),i=Math.min(o-1,m+1);s>2&&r.push("dots-start");for(let g=s;g<=i;g+=1)r.push(g);return i<o-1&&r.push("dots-end"),r.push(o),r};function ne({data:m,totalCount:o,page:r,pageSize:s,pageCount:i,onPageChange:g,onDelete:p,onEdit:d,onToggleVisibility:h,onViewEmployees:x}){const f=m.filter(a=>a.visible),j=o===0?0:(r-1)*s+1,T=o===0?0:Math.min(r*s,o),B=ee(r,i);return m.reduce((a,v)=>(typeof v.nhanSu=="number"&&(a[v.id]=v.nhanSu),a),{}),e.jsxs("div",{className:"overflow-hidden rounded-[24px] border border-slate-100 shadow-[0_18px_45px_rgba(15,23,42,0.08)] bg-white",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-500",children:e.jsx("tr",{children:["MÃ£ phÃ²ng","TÃªn phÃ²ng","TrÆ°á»Ÿng phÃ²ng","NÄƒm thÃ nh láº­p","NhÃ¢n sá»±","Tráº¡ng thÃ¡i","HÃ nh Ä‘á»™ng"].map(a=>e.jsx("th",{className:"px-6 py-4",children:a},a))})}),e.jsxs("tbody",{className:"bg-white text-sm text-slate-700",children:[f.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-8 text-center text-slate-400",children:"KhÃ´ng cÃ³ phÃ²ng ban nÃ o phÃ¹ há»£p vá»›i bá»™ lá»c"})}),f.map((a,v)=>e.jsxs("tr",{className:"border-b border-slate-100 last:border-b-0 hover:bg-slate-50/70",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"rounded-full bg-violet-100 px-3 py-1 text-xs font-semibold text-violet-600",children:a.maPhong})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-slate-100 text-slate-500",children:"ðŸ¢"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:a.tenPhong}),e.jsx("p",{className:"text-xs text-slate-500",children:"PhÃ²ng ban"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex h-9 w-9 items-center justify-center rounded-full text-sm font-semibold ${q[v%q.length]}`,children:Z(a.truongPhong||a.tenPhong)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:a.truongPhong||"ChÆ°a phÃ¢n cÃ´ng"}),e.jsx("p",{className:"text-xs text-slate-500",children:"TrÆ°á»Ÿng phÃ²ng"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-slate-700",children:a.namThanhLap}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{type:"button",title:"Xem danh sÃ¡ch nhÃ¢n sá»±",onClick:()=>x?.(a),className:"flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 shadow-sm transition hover:border-blue-200 hover:bg-blue-50 hover:text-blue-600",children:[e.jsx("div",{className:"flex -space-x-2",children:[0,1,2].map(L=>e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full border border-white bg-slate-100 text-slate-500",children:"ðŸ‘¤"},L))}),e.jsxs("span",{children:["+",a.nhanSu??0]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full px-4 py-1 text-xs font-semibold ${a.trangThai==="active"?"bg-green-50 text-green-600":"bg-slate-100 text-slate-500"}`,children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-current"}),a.trangThai==="active"?"Hoáº¡t Ä‘á»™ng":"NgÆ°ng"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{title:"Sá»­a",onClick:()=>d&&d(a),className:"rounded-full border border-blue-100 bg-blue-50 p-2 text-blue-600 shadow-sm transition hover:bg-blue-100",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx("button",{title:"áº¨n/hiá»‡n",className:"rounded-full border border-slate-200 bg-white p-2 text-slate-600 shadow-sm transition hover:bg-slate-50",onClick:()=>h(a.id),children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("button",{title:"XoÃ¡",onClick:()=>p(a.id),className:"rounded-full border border-red-100 bg-red-50 p-2 text-red-500 shadow-sm transition hover:bg-red-100",children:e.jsx(z,{className:"h-4 w-4"})})]})})]},a.id))]})]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 border-t border-slate-100 bg-white px-6 py-4 text-sm text-slate-500",children:[e.jsxs("p",{children:["Hiá»ƒn thá»‹ ",o===0?0:j,"-",T," trong"," ",o," káº¿t quáº£"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:bg-slate-50 disabled:opacity-40",disabled:r===1,onClick:()=>g(Math.max(1,r-1)),children:"â†"}),B.map((a,v)=>typeof a=="number"?e.jsx("button",{onClick:()=>g(a),className:`rounded-full px-3 py-1 ${a===r?"bg-blue-600 text-white shadow-md":"border border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:a},a):e.jsx("span",{className:"px-2",children:"..."},`${a}-${v}`)),e.jsx("button",{className:"rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:bg-slate-50 disabled:opacity-40",disabled:r===i,onClick:()=>g(Math.min(i,r+1)),children:"â†’"})]})]})]})}function ae({open:m,onClose:o,onSave:r}){const[s,i]=c.useState({maPhong:"",tenPhong:"",namThanhLap:new Date().getFullYear(),trangThai:"active"});c.useEffect(()=>{m&&i({maPhong:"",tenPhong:"",namThanhLap:new Date().getFullYear(),trangThai:"active"})},[m]);const g=d=>{const{name:h,value:x}=d.target;i(f=>({...f,[h]:h==="namThanhLap"?parseInt(x,10)||0:x}))};c.useEffect(()=>{i(d=>{if(!d.tenPhong)return d.maPhong?{...d,maPhong:""}:d;const h=I(d.tenPhong);return h&&d.maPhong!==h?{...d,maPhong:h}:d})},[s.tenPhong]);const p=d=>{if(d.preventDefault(),!s.tenPhong){alert("Vui lÃ²ng nháº­p TÃªn phÃ²ng.");return}if(!s.maPhong){alert("KhÃ´ng thá»ƒ táº¡o mÃ£ phÃ²ng ban. Vui lÃ²ng kiá»ƒm tra tÃªn phÃ²ng.");return}r(s)};return e.jsx(_,{open:m,onClose:o,title:"ThÃªm phÃ²ng ban",children:e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"ThÃ´ng tin cÆ¡ báº£n"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"MÃ£ phÃ²ng ban"}),e.jsx(P,{name:"maPhong",value:s.maPhong,readOnly:!0,className:"bg-slate-50",placeholder:"Sáº½ tá»± táº¡o tá»« tÃªn phÃ²ng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"TÃªn phÃ²ng ban"}),e.jsx(P,{name:"tenPhong",value:s.tenPhong,onChange:g,placeholder:"VD: PhÃ²ng Kinh Doanh",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"ThÃ´ng tin váº­n hÃ nh"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"NÄƒm thÃ nh láº­p"}),e.jsx(P,{name:"namThanhLap",type:"number",value:s.namThanhLap,onChange:g,placeholder:"VD: 2023",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Tráº¡ng thÃ¡i"}),e.jsxs(A,{name:"trangThai",value:s.trangThai,onChange:g,children:[e.jsx("option",{value:"active",children:"Hoáº¡t Ä‘á»™ng"}),e.jsx("option",{value:"inactive",children:"NgÆ°ng"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(S,{variant:"ghost",type:"button",onClick:o,children:"Huá»·"}),e.jsx(S,{type:"submit",children:"LÆ°u"})]})]})})}function te({open:m,onClose:o,onSave:r,department:s}){const[i,g]=c.useState({maPhong:"",tenPhong:"",namThanhLap:new Date().getFullYear(),trangThai:"active"});c.useEffect(()=>{s&&g({maPhong:s.maPhong,tenPhong:s.tenPhong,namThanhLap:s.namThanhLap,trangThai:s.trangThai})},[s]),c.useEffect(()=>{g(h=>{if(!h.tenPhong)return h;const x=I(h.tenPhong);return x&&h.maPhong!==x?{...h,maPhong:x}:h})},[i.tenPhong]);const p=h=>{const{name:x,value:f}=h.target;g(j=>({...j,[x]:x==="namThanhLap"?parseInt(f,10)||0:f}))},d=h=>{if(h.preventDefault(),!i.tenPhong){alert("TÃªn phÃ²ng khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng");return}if(!i.maPhong){alert("KhÃ´ng thá»ƒ táº¡o mÃ£ phÃ²ng ban.");return}r(i)};return s?e.jsx(_,{open:m,onClose:o,title:"Chá»‰nh sá»­a phÃ²ng ban",children:e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"MÃ£ phÃ²ng"}),e.jsx(P,{name:"maPhong",value:i.maPhong,readOnly:!0,className:"bg-slate-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"TÃªn phÃ²ng"}),e.jsx(P,{name:"tenPhong",value:i.tenPhong,onChange:p,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"NÄƒm thÃ nh láº­p"}),e.jsx(P,{name:"namThanhLap",type:"number",value:i.namThanhLap,onChange:p,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Tráº¡ng thÃ¡i"}),e.jsxs(A,{name:"trangThai",value:i.trangThai,onChange:p,children:[e.jsx("option",{value:"active",children:"Hoáº¡t Ä‘á»™ng"}),e.jsx("option",{value:"inactive",children:"NgÆ°ng"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(S,{variant:"ghost",type:"button",onClick:o,children:"Huá»·"}),e.jsx(S,{type:"submit",children:"LÆ°u thay Ä‘á»•i"})]})]})}):null}function ie(){const m=c.useMemo(()=>[{id:"1",maPhong:"PKD",tenPhong:"PhÃ²ng Kinh Doanh",namThanhLap:2020,trangThai:"active",visible:!0},{id:"2",maPhong:"PNS",tenPhong:"PhÃ²ng NhÃ¢n Sá»±",namThanhLap:2019,trangThai:"active",visible:!0},{id:"3",maPhong:"PKT",tenPhong:"PhÃ²ng Káº¿ ToÃ¡n",namThanhLap:2018,trangThai:"inactive",visible:!0}],[]),[o,r]=c.useState(()=>N.loadLocal(m)),[s,i]=c.useState(""),[g,p]=c.useState(!1),[d,h]=c.useState([]),[x,f]=c.useState(null),[j,T]=c.useState(1),[B,a]=c.useState({}),[v,L]=c.useState(!1),[D,k]=c.useState([]),[M,H]=c.useState(null),w=4,y=n=>{r(l=>{const t=n(l);return N.saveLocal(t),t})};c.useEffect(()=>{let n=!0;return(async()=>{try{const t=await N.list(m);n&&r(t)}catch(t){console.warn("KhÃ´ng thá»ƒ Ä‘á»“ng bá»™ phÃ²ng ban tá»« backend:",t)}})(),()=>{n=!1}},[m]),c.useEffect(()=>{const n=()=>{try{const l=localStorage.getItem("employeesData");if(!l){a({});return}const u=JSON.parse(l).reduce((b,C)=>(b[C.dept]=(b[C.dept]||0)+1,b),{});a(u)}catch(l){console.warn("KhÃ´ng Ä‘á»c Ä‘Æ°á»£c employeesData:",l),a({})}};return n(),window.addEventListener("storage",n),window.addEventListener("focus",n),()=>{window.removeEventListener("storage",n),window.removeEventListener("focus",n)}},[]);const E=c.useMemo(()=>{const n=o.filter(t=>!(s&&!(t.tenPhong.toLowerCase().includes(s.toLowerCase())||t.maPhong.toLowerCase().includes(s.toLowerCase())))),l=Math.max(1,Math.ceil(n.length/w));return j>l&&T(l),n},[o,s,j]),V=n=>I(n),O=async n=>{const l=n.maPhong||V(n.tenPhong),t={...n,maPhong:l};try{const u=await N.create(t);y(b=>[u,...b])}catch(u){console.warn("KhÃ´ng thá»ƒ táº¡o phÃ²ng ban qua API, lÆ°u local.",u);const b=N.createLocalRecord(t,$);y(C=>[b,...C])}K("ÄÃ£ thÃªm phÃ²ng ban"),p(!1)},F=async n=>{if(!x)return;const l={...n,maPhong:n.maPhong||V(n.tenPhong)};y(t=>t.map(u=>u.id===x.id?{...u,...l}:u));try{const t=await N.update(x.id,l);y(u=>u.map(b=>b.id===x.id?{...b,...t,visible:b.visible}:b))}catch(t){console.warn("KhÃ´ng thá»ƒ cáº­p nháº­t phÃ²ng ban qua API, giá»¯ dá»¯ liá»‡u local.",t)}K("ÄÃ£ cáº­p nháº­t phÃ²ng ban"),f(null)},R=async n=>{if(window.confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xoÃ¡ phÃ²ng ban nÃ y?")){y(t=>t.filter(u=>u.id!==n));try{await N.remove(n)}catch(t){console.warn("KhÃ´ng thá»ƒ xoÃ¡ phÃ²ng ban trÃªn backend, Ä‘Ã£ xoÃ¡ local.",t)}K("ÄÃ£ xÃ³a phÃ²ng ban")}},K=n=>{const l=$();h(t=>[...t,{id:l,noiDung:n}]),setTimeout(()=>{h(t=>t.filter(u=>u.id!==l))},3e3)},G=n=>{y(l=>l.map(t=>t.id===n?{...t,visible:!t.visible}:t))},Y=n=>{f(n)},J=n=>{H(n);try{const l=localStorage.getItem("employeesData");if(!l)k([]);else{const u=JSON.parse(l).filter(b=>b.dept===n.tenPhong);k(u)}}catch(l){console.warn("KhÃ´ng Ä‘á»c Ä‘Æ°á»£c employeesData:",l),k([])}L(!0)},U=()=>{L(!1),k([]),H(null)};return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"PhÃ²ng ban"}),e.jsx(S,{onClick:()=>p(!0),children:"+ ThÃªm phÃ²ng ban"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:e.jsx("div",{className:"md:col-span-2",children:e.jsx(P,{placeholder:"TÃ¬m theo tÃªn, mÃ£ phÃ²ng...",value:s,onChange:n=>{T(1),i(n.target.value)}})})}),e.jsx(ne,{data:E.slice((j-1)*w,j*w).map(n=>({...n,nhanSu:B[n.tenPhong]||0})),totalCount:E.length,page:j,pageSize:w,pageCount:Math.max(1,Math.ceil(E.length/w)),onPageChange:T,onDelete:R,onToggleVisibility:G,onEdit:Y,onViewEmployees:J}),e.jsx("div",{className:"fixed bottom-4 right-4 space-y-2 z-50",children:d.map(n=>e.jsx("div",{className:"bg-gray-800 text-white py-2 px-4 rounded-lg shadow-lg animate-fade-in-out",children:n.noiDung},n.id))}),e.jsx(W,{open:v,onClose:U,title:M?`NhÃ¢n sá»± - ${M.tenPhong}`:"NhÃ¢n sá»± phÃ²ng ban",employees:D,description:D.length?`CÃ³ ${D.length} nhÃ¢n viÃªn thuá»™c ${M?.tenPhong??"phÃ²ng ban"}.`:void 0,emptyDescription:"ChÆ°a cÃ³ nhÃ¢n viÃªn nÃ o trong phÃ²ng ban nÃ y."}),e.jsx(ae,{open:g,onClose:()=>p(!1),onSave:O}),e.jsx(te,{open:!!x,onClose:()=>f(null),department:x,onSave:F})]})})}export{ie as default};
