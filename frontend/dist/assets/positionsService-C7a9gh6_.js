import{s as o}from"./index-nuNE0MbF.js";const u="positionsData",d=()=>{if(typeof localStorage>"u")return[];const e=localStorage.getItem(u);if(!e)return[];try{return JSON.parse(e)}catch(t){return console.warn("Không đọc được positionsData:",t),[]}},s=e=>{typeof localStorage>"u"||localStorage.setItem(u,JSON.stringify(e))},a=(e=[])=>{const t=d();return t.length?t:(s(e),e)},c=e=>({id:e.id,maChucVu:e.code,tenChucVu:e.name,moTa:e.description??"",visible:!0}),h=(e,t)=>{const n=t.reduce((r,i)=>(r[i.id]=i.visible,r[i.maChucVu]=i.visible,r),{});return e.map(r=>({...r,visible:n[r.id]??n[r.maChucVu]??!0}))},l={loadLocal(e){return a(e)},saveLocal:s,async list(e){const t=a(e);try{const{data:n,error:r}=await o.from("positions").select("id, code, name, description").order("name",{ascending:!0});if(r)throw r;const i=h((n??[]).map(c),t);return s(i),i}catch(n){return console.warn("Không thể tải danh sách chức vụ từ backend, dùng dữ liệu cache.",n),t}},async create(e){const{data:t,error:n}=await o.from("positions").insert({code:e.maChucVu,name:e.tenChucVu,description:e.moTa??null}).select("id, code, name, description").single();if(n||!t)throw n??new Error("Không thể tạo chức vụ.");return c(t)},async update(e,t){const n={};t.maChucVu!==void 0&&(n.code=t.maChucVu),t.tenChucVu!==void 0&&(n.name=t.tenChucVu),t.moTa!==void 0&&(n.description=t.moTa);const{data:r,error:i}=await o.from("positions").update(n).eq("id",e).select("id, code, name, description").single();if(i||!r)throw i??new Error("Không thể cập nhật chức vụ.");return c(r)},async remove(e){const{error:t}=await o.from("positions").delete().eq("id",e);if(t)throw t}};export{l as p};
