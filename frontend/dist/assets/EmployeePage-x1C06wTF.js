import{j as e,r as l,b as Q,I as T,B as R,e as Ie,u as Ke,g as De,l as Z,a as W,n as Ae,c as F}from"./index-nuNE0MbF.js";import{c as se,P as Ve,T as Ee,M as U,v as re}from"./Modal-Bp8GA-AI.js";import{S as $}from"./Select-BSFxTWHW.js";import{a as ne,l as ee,s as te,c as Te,b as Me,d as He,e as Oe,r as Le,f as Fe,p as Re}from"./payrollService-li453Ssr.js";import{d as $e}from"./departmentsService-CwK6u15h.js";import{p as qe}from"./positionsService-C7a9gh6_.js";const _e=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Je=se("eye-off",_e);const ze=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Be=se("eye",ze);const Ue=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Ge=se("user",Ue);function Qe({data:p,totalCount:b,page:s,pageSize:i,pageCount:r,onDelete:o,onEdit:u,onRegisterFace:P,onViewPayroll:w,onViewDetail:j,onViewAttendance:v,onToggleVisibility:d,showHidden:S=!1,onPageChange:N}){const g=S?p:p.filter(n=>n.visible),C=b===0?0:(s-1)*i+1,a=b===0?0:Math.min(s*i,b),f=(()=>{if(r<=5)return Array.from({length:r},(V,L)=>L+1);const n=[1];let m=Math.max(2,s-1),A=Math.min(r-1,s+1);m>2&&n.push("dots-start");for(let V=m;V<=A;V+=1)n.push(V);return A<r-1&&n.push("dots-end"),n.push(r),n})(),k=n=>{if(n.photo)return e.jsx("img",{src:n.photo,alt:n.name,className:"h-11 w-11 rounded-full object-cover"});const m=n.name.split(" ").slice(-2).map(A=>A.charAt(0)).join("").toUpperCase();return e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-slate-100 text-sm font-semibold text-slate-500",children:m})};return e.jsxs("div",{className:"overflow-hidden rounded-[24px] border border-slate-100 shadow-[0_18px_45px_rgba(15,23,42,0.08)]",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-500",children:e.jsx("tr",{children:["MÃ£ NV","Há» vÃ  tÃªn","PhÃ²ng ban","Chá»©c vá»¥","LÆ°Æ¡ng","Tráº¡ng thÃ¡i","HÃ nh Ä‘á»™ng"].map(n=>e.jsx("th",{className:"px-6 py-4",children:n},n))})}),e.jsxs("tbody",{className:"bg-white text-sm text-slate-600",children:[g.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-10 text-center text-slate-400",children:"KhÃ´ng cÃ³ nhÃ¢n viÃªn phÃ¹ há»£p vá»›i bá»™ lá»c"})}),g.map(n=>e.jsxs("tr",{className:`border-b border-slate-100 last:border-b-0 hover:bg-slate-50/60 ${n.visible?"":"bg-slate-50/70"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-700",children:n.code})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[k(n),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:n.name}),!n.visible&&e.jsx("p",{className:"text-[11px] font-semibold text-rose-500",children:"Äang bá»‹ áº©n"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-slate-700",children:n.dept}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600",children:n.position})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{w&&w(n)},className:"inline-flex items-center gap-2 rounded-full bg-blue-50 px-4 py-1.5 text-xs font-semibold text-blue-600 shadow-sm transition hover:bg-blue-100",children:"ðŸ’° Xem lÆ°Æ¡ng"}),e.jsx("button",{type:"button",onClick:()=>v&&v(n),className:"inline-flex items-center gap-2 rounded-full bg-violet-50 px-4 py-1.5 text-xs font-semibold text-violet-600 shadow-sm transition hover:bg-violet-100",children:"ðŸ•’ Lá»‹ch sá»­ cÃ´ng"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full px-4 py-1 text-xs font-semibold ${n.status==="active"?"bg-green-50 text-green-600":"bg-slate-100 text-slate-500"}`,children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-current"}),n.status==="active"?"Hoáº¡t Ä‘á»™ng":"NgÆ°ng"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{title:"Sá»­a",onClick:()=>u&&u(n),className:"rounded-full border border-blue-100 bg-blue-50 p-2 text-blue-600 shadow-sm transition hover:bg-blue-100",children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx("button",{title:"XoÃ¡",onClick:()=>o(n.id),className:"rounded-full border border-red-100 bg-red-50 p-2 text-red-500 shadow-sm transition hover:bg-red-100",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx("button",{title:n.visible?"áº¨n nhÃ¢n viÃªn":"Bá» áº©n nhÃ¢n viÃªn",onClick:()=>d&&d(n.id),className:"rounded-full border border-slate-200 bg-white p-2 text-slate-600 shadow-sm transition hover:bg-slate-50",children:n.visible?e.jsx(Je,{className:"h-4 w-4"}):e.jsx(Be,{className:"h-4 w-4"})}),e.jsx("button",{title:"ÄÄƒng kÃ½ khuÃ´n máº·t",onClick:()=>P(n),className:"rounded-full border border-emerald-100 bg-emerald-50 p-2 text-emerald-600 shadow-sm transition hover:bg-emerald-100",children:e.jsx(Ge,{className:"h-4 w-4"})})]})})]},n.id))]})]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 border-t border-slate-100 bg-white px-6 py-4 text-sm text-slate-500",children:[e.jsxs("p",{children:["Hiá»ƒn thá»‹ ",b===0?0:C,"-",a," trong"," ",b," nhÃ¢n viÃªn"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:bg-slate-50 disabled:opacity-40",disabled:s===1,onClick:()=>N(Math.max(1,s-1)),children:"â†"}),f.map((n,m)=>typeof n=="number"?e.jsx("button",{onClick:()=>N(n),className:`rounded-full px-3 py-1 ${n===s?"bg-blue-600 text-white shadow-md":"border border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:n},n):e.jsx("span",{className:"px-2",children:"..."},`${n}-${m}`)),e.jsx("button",{className:"rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:bg-slate-50 disabled:opacity-40",disabled:s===r,onClick:()=>N(Math.min(r,s+1)),children:"â†’"})]})]})]})}const Ye=[{id:"dept-1",tenPhong:"PhÃ²ng Kinh Doanh",maPhong:"PKD",visible:!0},{id:"dept-2",tenPhong:"PhÃ²ng NhÃ¢n Sá»±",maPhong:"PNS",visible:!0},{id:"dept-3",tenPhong:"PhÃ²ng Káº¿ ToÃ¡n",maPhong:"PKT",visible:!0}],Xe=[{id:"pos-1",tenChucVu:"NhÃ¢n viÃªn",maChucVu:"N",visible:!0},{id:"pos-2",tenChucVu:"TrÆ°á»Ÿng phÃ²ng",maChucVu:"T",visible:!0},{id:"pos-3",tenChucVu:"GiÃ¡m Ä‘á»‘c",maChucVu:"G",visible:!0}],oe=(p,b)=>{try{const s=localStorage.getItem(p);if(!s)return b;const i=JSON.parse(s);return Array.isArray(i)?i:b}catch(s){return console.warn(`KhÃ´ng Ä‘á»c Ä‘Æ°á»£c dá»¯ liá»‡u ${p}:`,s),b}};function Ze({open:p,onClose:b,onSave:s,nextJoinOrder:i}){const r=()=>({name:"",code:"",dept:"",departmentId:null,position:"",positionId:null,baseSalary:0,status:"active",photo:"",taiKhoan:"",matKhau:"",joinedAt:new Date().toISOString().slice(0,10)}),[o,u]=l.useState(r),[P,w]=l.useState(null),[j,v]=l.useState([]),[d,S]=l.useState([]);l.useEffect(()=>{if(!p)return;u(r()),w(null);const a=oe("departmentsData",Ye),c=oe("positionsData",Xe);v(a.filter(f=>f.visible??!0)),S(c.filter(f=>f.visible??!0))},[p]),l.useEffect(()=>{j.length>0&&!o.dept&&u(a=>({...a,dept:j[0].tenPhong,departmentId:j[0].id}))},[j,o.dept]),l.useEffect(()=>{d.length>0&&!o.position&&u(a=>({...a,position:d[0].tenChucVu,positionId:d[0].id}))},[d,o.position]),l.useEffect(()=>{if(!o.dept||!o.position||!i)return;const a=Q({deptName:o.dept,positionName:o.position,joinOrder:i,departments:j,positions:d});u(c=>c.code===a?c:{...c,code:a})},[o.dept,o.position,i,j,d]);const N=a=>{const{name:c,value:f}=a.target;u(k=>{if(c==="dept"){const n=j.find(m=>m.tenPhong===f);return{...k,dept:f,departmentId:n?.id??null}}if(c==="position"){const n=d.find(m=>m.tenChucVu===f);return{...k,position:f,positionId:n?.id??null}}return c==="baseSalary"?{...k,baseSalary:parseFloat(f)||0}:{...k,[c]:f}})},g=a=>{const c=a.target.files?.[0];if(!c)return;const f=new FileReader;f.onload=()=>{const k=f.result;u(n=>({...n,photo:k})),w(k)},f.readAsDataURL(c)},C=a=>{if(a.preventDefault(),!o.name){alert("Vui lÃ²ng nháº­p há» tÃªn.");return}if(!o.taiKhoan||!o.matKhau){alert("Vui lÃ²ng nháº­p tÃ i khoáº£n vÃ  máº­t kháº©u cháº¥m cÃ´ng.");return}s(o)};return e.jsx(U,{open:p,onClose:b,title:"ThÃªm nhÃ¢n viÃªn",children:e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"ThÃ´ng tin cÆ¡ báº£n"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"MÃ£ nhÃ¢n viÃªn"}),e.jsx(T,{name:"code",value:o.code,readOnly:!0,className:"bg-slate-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Há» vÃ  tÃªn Ä‘áº§y Ä‘á»§"}),e.jsx(T,{name:"name",value:o.name,onChange:N,placeholder:"VD: Nguyá»…n Minh Anh",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"ThÃ´ng tin cÃ´ng viá»‡c"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"PhÃ²ng ban"}),e.jsx($,{name:"dept",value:o.dept,onChange:N,required:!0,children:j.length===0?e.jsx("option",{value:"",children:"ChÆ°a cÃ³ phÃ²ng ban nÃ o. Vui lÃ²ng táº¡o trÆ°á»›c á»Ÿ trang PhÃ²ng ban."}):j.map(a=>e.jsx("option",{value:a.tenPhong,children:a.tenPhong},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Chá»©c vá»¥"}),e.jsx($,{name:"position",value:o.position,onChange:N,required:!0,children:d.length===0?e.jsx("option",{value:"",children:"ChÆ°a cÃ³ chá»©c vá»¥ nÃ o. Vui lÃ²ng táº¡o trÆ°á»›c á»Ÿ trang Chá»©c vá»¥."}):d.map(a=>e.jsx("option",{value:a.tenChucVu,children:a.tenChucVu},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"LÆ°Æ¡ng cÆ¡ báº£n (VNÄ)"}),e.jsx(T,{name:"baseSalary",type:"number",value:o.baseSalary,onChange:N,placeholder:"VD: 15000000",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"NgÃ y vÃ o cÃ´ng ty"}),e.jsx(T,{name:"joinedAt",type:"date",value:o.joinedAt,onChange:N,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Tráº¡ng thÃ¡i"}),e.jsxs($,{name:"status",value:o.status,onChange:N,children:[e.jsx("option",{value:"active",children:"Hoáº¡t Ä‘á»™ng"}),e.jsx("option",{value:"inactive",children:"NgÆ°ng"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"TÃ i khoáº£n nhÃ¢n viÃªn"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-600 mb-2",children:"TÃ i khoáº£n Ä‘Äƒng nháº­p"}),e.jsx(T,{name:"taiKhoan",value:o.taiKhoan,onChange:N,placeholder:"VD: minh.anh",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-600 mb-2",children:"Máº­t kháº©u"}),e.jsx(T,{name:"matKhau",type:"password",value:o.matKhau,onChange:N,placeholder:"Ãt nháº¥t 6 kÃ½ tá»±",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"áº¢nh nháº­n diá»‡n"}),e.jsx("label",{className:"block text-sm font-semibold text-slate-900 mb-2",children:"Chá»n áº£nh nhÃ¢n viÃªn"}),e.jsx("input",{type:"file",accept:"image/*",onChange:g,className:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-600 hover:file:bg-blue-100"}),e.jsx("div",{className:"mt-3",children:P?e.jsx("img",{src:P,alt:"Xem trÆ°á»›c",className:"w-24 h-24 rounded-xl object-cover border border-gray-200 shadow-sm"}):e.jsx("p",{className:"text-xs text-gray-500"})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(R,{variant:"ghost",type:"button",onClick:b,children:"Huá»·"}),e.jsx(R,{type:"submit",children:"LÆ°u"})]})]})})}const We=[{id:"dept-1",tenPhong:"PhÃ²ng Kinh Doanh",maPhong:"PKD",visible:!0},{id:"dept-2",tenPhong:"PhÃ²ng NhÃ¢n Sá»±",maPhong:"PNS",visible:!0},{id:"dept-3",tenPhong:"PhÃ²ng Káº¿ ToÃ¡n",maPhong:"PKT",visible:!0}],et=[{id:"pos-1",tenChucVu:"NhÃ¢n viÃªn",maChucVu:"N",visible:!0},{id:"pos-2",tenChucVu:"TrÆ°á»Ÿng phÃ²ng",maChucVu:"T",visible:!0},{id:"pos-3",tenChucVu:"GiÃ¡m Ä‘á»‘c",maChucVu:"G",visible:!0}],ce=(p,b)=>{try{const s=localStorage.getItem(p);if(!s)return b;const i=JSON.parse(s);return Array.isArray(i)?i:b}catch(s){return console.warn(`KhÃ´ng Ä‘á»c Ä‘Æ°á»£c dá»¯ liá»‡u ${p}:`,s),b}};function tt({open:p,onClose:b,onSave:s,employee:i}){const[r,o]=l.useState({code:"",name:"",dept:"",departmentId:null,position:"",positionId:null,photo:null,baseSalary:0,status:"active",taiKhoan:"",matKhau:"",joinedAt:new Date().toISOString().slice(0,10)}),[u,P]=l.useState([]),[w,j]=l.useState([]),[v,d]=l.useState(1);l.useEffect(()=>{if(i){o({name:i.name,dept:i.dept,position:i.position,departmentId:i.departmentId??null,positionId:i.positionId??null,photo:i.photo??null,baseSalary:i.baseSalary,code:i.code,status:i.status,taiKhoan:i.taiKhoan,matKhau:i.matKhau,joinedAt:i.joinedAt?.slice(0,10)??new Date().toISOString().slice(0,10)});const g=i.joinOrder??Ie(i.code)??1;d(g)}},[i]),l.useEffect(()=>{if(!p)return;const g=ce("departmentsData",We),C=ce("positionsData",et),a=g.filter(f=>f.visible??!0),c=C.filter(f=>f.visible??!0);if(i){if(!a.some(n=>n.tenPhong===i.dept)){const n=g.find(m=>m.tenPhong===i.dept);n&&a.push(n)}if(!c.some(n=>n.tenChucVu===i.position)){const n=C.find(m=>m.tenChucVu===i.position);n&&c.push(n)}}P(a),j(c)},[p,i]),l.useEffect(()=>{if(!i||!r.dept||!r.position)return;const g=Q({deptName:r.dept,positionName:r.position,joinOrder:v,departments:u,positions:w});o(C=>C.code===g?C:{...C,code:g})},[r.dept,r.position,v,u,w,i]);const S=g=>{const{name:C,value:a}=g.target;o(c=>{if(C==="dept"){const f=u.find(k=>k.tenPhong===a);return{...c,dept:a,departmentId:f?.id??null}}if(C==="position"){const f=w.find(k=>k.tenChucVu===a);return{...c,position:a,positionId:f?.id??null}}return C==="baseSalary"?{...c,baseSalary:parseFloat(a)||0}:{...c,[C]:a}})},N=g=>{if(g.preventDefault(),!r.name)return alert("TÃªn khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng");if(!r.taiKhoan||!r.matKhau)return alert("Cáº§n nháº­p tÃ i khoáº£n vÃ  máº­t kháº©u.");s(r)};return i?e.jsx(U,{open:p,onClose:b,title:"Chá»‰nh sá»­a nhÃ¢n viÃªn",titleClassName:"text-black",children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"MÃ£ nhÃ¢n viÃªn"}),e.jsx(T,{name:"code",value:r.code,readOnly:!0,className:"bg-slate-50",placeholder:"MÃ£ tá»± Ä‘á»™ng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Há» tÃªn"}),e.jsx(T,{name:"name",value:r.name,onChange:S,required:!0,placeholder:"Nháº­p há» tÃªn"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"PhÃ²ng ban"}),e.jsx($,{name:"dept",value:r.dept,onChange:S,required:!0,children:u.length===0?e.jsx("option",{value:"",children:"ChÆ°a cÃ³ phÃ²ng ban kháº£ dá»¥ng"}):u.map(g=>e.jsx("option",{value:g.tenPhong,children:g.tenPhong},g.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Chá»©c vá»¥"}),e.jsx($,{name:"position",value:r.position,onChange:S,required:!0,children:w.length===0?e.jsx("option",{value:"",children:"ChÆ°a cÃ³ chá»©c vá»¥ kháº£ dá»¥ng"}):w.map(g=>e.jsx("option",{value:g.tenChucVu,children:g.tenChucVu},g.id))})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"LÆ°Æ¡ng cÆ¡ báº£n"}),e.jsx(T,{name:"baseSalary",type:"number",value:r.baseSalary,onChange:S,required:!0,placeholder:"VD: 15000000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"NgÃ y vÃ o cÃ´ng ty"}),e.jsx(T,{name:"joinedAt",type:"date",value:r.joinedAt,onChange:S,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"TÃ i khoáº£n Ä‘Äƒng nháº­p"}),e.jsx(T,{name:"taiKhoan",value:r.taiKhoan,onChange:S,required:!0,placeholder:"VD: dao.nhat"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Máº­t kháº©u"}),e.jsx(T,{name:"matKhau",type:"password",value:r.matKhau,onChange:S,required:!0,placeholder:"Ãt nháº¥t 6 kÃ½ tá»±"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tráº¡ng thÃ¡i"}),e.jsxs($,{name:"status",value:r.status,onChange:S,children:[e.jsx("option",{value:"active",children:"Hoáº¡t Ä‘á»™ng"}),e.jsx("option",{value:"inactive",children:"NgÆ°ng"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(R,{variant:"ghost",type:"button",onClick:b,children:"Huá»·"}),e.jsx(R,{type:"submit",children:"LÆ°u thay Ä‘á»•i"})]})]})}):null}function st({q:p,onQueryChange:b,dept:s,onDeptChange:i,status:r,onStatusChange:o}){return e.jsxs("div",{className:"grid gap-4 md:grid-cols-[minmax(0,2.2fr)_minmax(0,1fr)_minmax(0,1fr)]",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",children:"ðŸ”"}),e.jsx(T,{placeholder:"TÃ¬m theo tÃªn, mÃ£ nhÃ¢n viÃªn...",value:p,onChange:u=>b(u.target.value),className:"rounded-2xl border-slate-200 bg-slate-50 pl-12 py-3 text-sm"})]}),e.jsx("div",{children:e.jsxs($,{value:s,onChange:u=>i(u.target.value),className:"rounded-2xl border-slate-200 bg-white py-3 text-sm text-slate-600",children:[e.jsx("option",{value:"all",children:"Táº¥t cáº£ phÃ²ng ban"}),e.jsx("option",{value:"PhÃ²ng Kinh Doanh",children:"PhÃ²ng Kinh Doanh"}),e.jsx("option",{value:"TrÆ°á»Ÿng phÃ²ng",children:"Ban GiÃ¡m Äá»‘c"}),e.jsx("option",{value:"ChÄƒm sÃ³c KH",children:"ChÄƒm sÃ³c KH"})]})}),e.jsx("div",{children:e.jsxs($,{value:r,onChange:u=>o(u.target.value),className:"rounded-2xl border-slate-200 bg-white py-3 text-sm text-slate-600",children:[e.jsx("option",{value:"all",children:"Táº¥t cáº£ chá»©c vá»¥"}),e.jsx("option",{value:"active",children:"Hoáº¡t Ä‘á»™ng"}),e.jsx("option",{value:"inactive",children:"NgÆ°ng"})]})})]})}function nt({open:p,onClose:b,employee:s}){if(!s)return null;const[i,r]=l.useState({history:[],monthlyHours:0,loading:!1});l.useEffect(()=>{if(!p||!s)return;let v=!0;return r(d=>({...d,loading:!0})),(async()=>{try{const d=await ne.fetchAttendanceHistory(s.id,50),S=d.length?d:ee(s.id),N=te(S);v&&r({history:N.history,monthlyHours:N.monthlyHours,loading:!1})}catch(d){if(console.warn("KhÃ´ng táº£i Ä‘Æ°á»£c lá»‹ch sá»­ cháº¥m cÃ´ng cá»§a nhÃ¢n viÃªn.",d),v){const S=te(ee(s.id));r({history:S.history,monthlyHours:S.monthlyHours,loading:!1})}}})(),()=>{v=!1}},[s,p]);const o=v=>Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(v),u=v=>{if(!v)return"â€”";const d=new Date(v);return Number.isNaN(d.getTime())?"â€”":new Intl.DateTimeFormat("vi-VN").format(d)},P=s.name.split(" ").map(v=>v[0]).join("").slice(0,2).toUpperCase(),w=Te(i.monthlyHours,s.baseSalary),j=i.history.slice(0,5);return e.jsx(U,{open:p,onClose:b,title:"ThÃ´ng tin nhÃ¢n viÃªn",children:e.jsxs("div",{className:"space-y-5 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4 rounded-2xl border border-gray-100 bg-gradient-to-r from-blue-50 to-white p-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl overflow-hidden bg-white shadow-inner flex items-center justify-center text-lg font-semibold text-blue-600",children:s.photo?e.jsx("img",{src:s.photo,alt:s.name,className:"w-full h-full object-cover"}):P}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-blue-500",children:"NhÃ¢n viÃªn"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.position})]}),e.jsx("span",{className:`ml-auto rounded-full px-3 py-1 text-xs font-semibold ${s.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:s.status==="active"?"Hoáº¡t Ä‘á»™ng":"NgÆ°ng"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 rounded-xl border border-gray-100 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"MÃ£ nhÃ¢n viÃªn"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.code})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"PhÃ²ng ban"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.dept})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Chá»©c vá»¥"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.position})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"LÆ°Æ¡ng cÆ¡ báº£n"}),e.jsx("span",{className:"font-semibold text-gray-900",children:o(s.baseSalary)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"NgÃ y vÃ o cÃ´ng ty"}),e.jsx("span",{className:"font-medium text-gray-900",children:u(s.joinedAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"TÃ i khoáº£n"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.taiKhoan||"ChÆ°a thiáº¿t láº­p"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Máº­t kháº©u"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.matKhau||"ChÆ°a thiáº¿t láº­p"})]})]}),e.jsxs("div",{className:"space-y-4 rounded-xl border border-gray-100 bg-white p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Cháº¥m cÃ´ng & lÆ°Æ¡ng thÃ¡ng nÃ y"}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl bg-slate-50 p-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Tá»•ng sá»‘ giá» Ä‘Ã£ lÃ m"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-900 mt-1",children:[i.monthlyHours.toFixed(2),"h"]})]}),e.jsxs("div",{className:"rounded-xl bg-slate-50 p-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"LÆ°Æ¡ng dá»± kiáº¿n"}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-600 mt-1",children:[w.projectedSalary.toLocaleString("vi-VN"),"â‚«"]}),e.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:w.hasBaseSalary?w.overtimeHours>0?`Gá»“m ${w.overtimeHours.toFixed(2)}h lÃ m thÃªm (+${w.overtimePay.toLocaleString("vi-VN")}â‚«)`:"ÄÃ£ Ä‘á»§ 40 giá», hiá»ƒn thá»‹ lÆ°Æ¡ng cÆ¡ báº£n":"ChÆ°a Ä‘á»§ 40 giá» Ä‘á»ƒ nháº­n lÆ°Æ¡ng cÆ¡ báº£n"})]}),e.jsxs("div",{className:"rounded-xl bg-slate-50 p-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Sá»‘ láº§n cháº¥m cÃ´ng"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 mt-1",children:i.history.length})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700 mb-3",children:"Lá»‹ch sá»­ gáº§n Ä‘Ã¢y"}),i.loading?e.jsx("p",{className:"text-sm text-slate-500",children:"Äang táº£i dá»¯ liá»‡u..."}):j.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"ChÆ°a cÃ³ dá»¯ liá»‡u cháº¥m cÃ´ng."}):e.jsx("ul",{className:"space-y-2",children:j.map(v=>{const d=new Date(v.timestamp);return e.jsxs("li",{className:"flex items-center justify-between rounded-xl bg-slate-50 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:v.type==="checkin"?"Check-in":"Check-out"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[d.toLocaleDateString("vi-VN")," â€¢ ",d.toLocaleTimeString("vi-VN")]})]}),typeof v.durationHours=="number"&&v.durationHours>0&&e.jsxs("span",{className:"text-xs font-semibold text-emerald-600",children:["+",v.durationHours.toFixed(2),"h"]})]},v.id)})})]})]})]})})}function at({open:p,onClose:b,employee:s,onSaved:i}){const r=l.useRef(null),o=l.useRef(null),[u,P]=l.useState(null),[w,j]=l.useState(null),[v,d]=l.useState(!1),[S,N]=l.useState(null),[g,C]=l.useState(!1),[a,c]=l.useState(!1);l.useEffect(()=>{if(!p)return;let m=!0;return(async()=>{try{const V=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});if(!m){V.getTracks().forEach(L=>L.stop());return}o.current=V,r.current&&(r.current.srcObject=V,await r.current.play()),d(!0),j(null)}catch(V){const L=V instanceof Error?V.message:"KhÃ´ng thá»ƒ truy cáº­p camera trÃªn thiáº¿t bá»‹ nÃ y.";j(L),d(!1)}})(),()=>{m=!1,o.current?.getTracks().forEach(V=>V.stop()),o.current=null,P(null),j(null),d(!1),N(null),C(!1),c(!1)}},[p]);const f=async()=>{if(r.current){C(!0);try{const m=await Me(r.current);if(!m.descriptor){P(null),N(null),j("KhÃ´ng tÃ¬m tháº¥y khuÃ´n máº·t. Vui lÃ²ng thá»­ láº¡i vá»›i Ã¡nh sÃ¡ng tá»‘t hÆ¡n.");return}P(m.dataUrl),N(m.descriptor),j(null)}catch(m){const A=m instanceof Error?m.message:"KhÃ´ng thá»ƒ nháº­n diá»‡n khuÃ´n máº·t. Vui lÃ²ng thá»­ láº¡i.";j(A),P(null),N(null)}finally{C(!1)}}},k=()=>{P(null),N(null),j(null)},n=async()=>{if(!S||!s){j("Vui lÃ²ng chá»¥p khuÃ´n máº·t trÆ°á»›c khi lÆ°u.");return}c(!0);try{await ne.enrollFace({employeeId:s.id,embedding:He(S),snapshot:u??void 0}),i?.()}catch(m){const A=m instanceof Error?m.message:"KhÃ´ng thá»ƒ lÆ°u khuÃ´n máº·t. Vui lÃ²ng thá»­ láº¡i.";j(A)}finally{c(!1)}};return s?e.jsx(U,{open:p,onClose:b,title:"ÄÄƒng kÃ½ khuÃ´n máº·t",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vui lÃ²ng nhÃ¬n tháº³ng vÃ o camera, giá»¯ á»•n Ä‘á»‹nh khuÃ´n máº·t trong khung vÃ  nháº¥n â€œChá»¥pâ€."}),e.jsx("div",{className:"relative rounded-2xl bg-black/80 overflow-hidden aspect-video",children:u?e.jsx("img",{src:u,alt:"áº¢nh khuÃ´n máº·t",className:"w-full h-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:r,className:"w-full h-full object-cover",autoPlay:!0,muted:!0,playsInline:!0}),!v&&e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white bg-black/50 text-sm",children:w??"Äang khá»Ÿi Ä‘á»™ng camera..."})]})}),e.jsx("div",{className:"flex flex-wrap gap-3 justify-end",children:u?e.jsxs(e.Fragment,{children:[e.jsx(R,{variant:"ghost",type:"button",onClick:k,children:"Chá»¥p láº¡i"}),e.jsx(R,{type:"button",onClick:n,disabled:a,children:a?"Äang lÆ°u...":"LÆ°u khuÃ´n máº·t"})]}):e.jsx(R,{type:"button",onClick:f,disabled:!v||!!w||g,children:g?"Äang xá»­ lÃ½...":"Chá»¥p"})}),w&&e.jsxs("p",{className:"text-sm text-red-600",children:[w," Vui lÃ²ng kiá»ƒm tra quyá»n camera vÃ  thá»­ láº¡i."]})]})}):null}function it({open:p,onClose:b,employee:s}){const[i,r]=l.useState([]),[o,u]=l.useState(0),[P,w]=l.useState(!1),[j,v]=l.useState("local"),[d,S]=l.useState(null);l.useEffect(()=>{if(!s)return;const a=Oe(s.id);a?(u(a.hours),S({year:a.year,month:a.month})):(u(0),S(null))},[s]),l.useEffect(()=>{if(!p||!s)return;let a=!0;const c=(k,n)=>{const m=Le(k,new Date),A=te(k,m);a&&(r(A.history),u(A.monthlyHours),S({year:m.getFullYear(),month:m.getMonth()+1}),Fe(s.id,{year:m.getFullYear(),month:m.getMonth()+1,hours:A.monthlyHours,updatedAt:new Date().toISOString()}),v(n))};return(async()=>{w(!0);try{const n=await ne.fetchAttendanceHistory(s.id);if(n.length){c(n,"remote");return}}catch(n){console.warn("KhÃ´ng táº£i Ä‘Æ°á»£c lá»‹ch sá»­ cháº¥m cÃ´ng cá»§a nhÃ¢n viÃªn.",n)}const k=ee(s.id);c(k,"local")})(),()=>{a=!1}},[p,s]);const N=l.useMemo(()=>!i.length||!d?0:i.filter(a=>{const c=new Date(a.timestamp);return c.getFullYear()===d.year&&c.getMonth()===d.month-1}).length,[i,d]);if(!s)return null;const g=new Intl.DateTimeFormat("vi-VN",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit"}),C=[...i].sort((a,c)=>new Date(c.timestamp).getTime()-new Date(a.timestamp).getTime());return e.jsx(U,{open:p,onClose:b,title:`Lá»‹ch sá»­ cháº¥m cÃ´ng - ${s.name}`,titleClassName:"text-slate-900",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:d?`Tá»•ng giá» thÃ¡ng ${d.month}/${d.year}`:"Tá»•ng giá» thÃ¡ng nÃ y"}),e.jsxs("p",{className:"mt-2 text-3xl font-bold text-slate-900",children:[o.toFixed(2),"h"]}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Sá»‘ láº§n cháº¥m cÃ´ng trong thÃ¡ng: ",N,j==="remote"?"":" â€¢ Dá»¯ liá»‡u trÃªn thiáº¿t bá»‹"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700 mb-3",children:P?"Äang táº£i lá»‹ch sá»­...":"Lá»‹ch sá»­ gáº§n Ä‘Ã¢y"}),C.length===0?e.jsx("p",{className:"text-sm text-slate-500",children:"ChÆ°a cÃ³ dá»¯ liá»‡u cháº¥m cÃ´ng."}):e.jsx("ul",{className:"space-y-2 max-h-72 overflow-y-auto pr-1",children:C.map(a=>e.jsxs("li",{className:"flex items-center justify-between rounded-xl border border-slate-100 bg-white px-4 py-2 shadow-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:a.type==="checkin"?"Check-in":"Check-out"}),e.jsx("p",{className:"text-xs text-slate-500",children:g.format(new Date(a.timestamp))})]}),typeof a.durationHours=="number"&&e.jsxs("span",{className:"text-sm font-semibold text-emerald-600",children:["+",a.durationHours.toFixed(2),"h"]})]},a.id))})]})]})})}function ut(){const p=Ke(),b=4,s=t=>new Date(t).toISOString(),i=[{id:"1",code:"PKDN0001",name:"Nguyá»…n Minh Anh",dept:"PhÃ²ng Kinh Doanh",departmentId:"dept-1",position:"NhÃ¢n viÃªn",positionId:"pos-1",baseSalary:1e7,status:"active",visible:!0,photo:"https://i.pravatar.cc/150?img=3",joinOrder:1,joinedAt:s("2023-01-10"),taiKhoan:"minhanh",matKhau:"123456",account:"minhanh",password:"123456",createdAt:s("2023-01-10"),updatedAt:s("2023-01-10")},{id:"2",code:"PTPT0002",name:"Nguyá»…n Minh Táº¡o",dept:"TrÆ°á»Ÿng phÃ²ng",departmentId:"dept-2",position:"TrÆ°á»Ÿng phÃ²ng",positionId:"pos-2",baseSalary:2e7,status:"active",visible:!0,photo:"https://i.pravatar.cc/150?img=15",joinOrder:2,joinedAt:s("2023-03-05"),taiKhoan:"taonguyen",matKhau:"123456",account:"taonguyen",password:"123456",createdAt:s("2023-03-05"),updatedAt:s("2023-03-05")},{id:"3",code:"PCKN0003",name:"Tráº§n Quá»³nh",dept:"ChÄƒm sÃ³c KH",departmentId:"dept-3",position:"NhÃ¢n viÃªn",positionId:"pos-1",baseSalary:12e6,status:"inactive",visible:!0,photo:"https://i.pravatar.cc/150?img=32",joinOrder:3,joinedAt:s("2023-06-18"),taiKhoan:"quynhtran",matKhau:"123456",account:"quynhtran",password:"123456",createdAt:s("2023-06-18"),updatedAt:s("2023-06-18")}],r=t=>{const y=Z(),x=W();return Ae(t.map(h=>({...h,code:h.code??""}))).map((h,K)=>{const M=new Date().toISOString(),D=y.find(X=>X.tenPhong===h.dept),H=x.find(X=>X.tenChucVu===h.position),E=typeof h.joinedAt=="string"?h.joinedAt:typeof h.createdAt=="string"?h.createdAt:M,O=new Date(E),B=Number.isNaN(O.getTime())?M:O.toISOString(),J=typeof h.createdAt=="string"&&!Number.isNaN(new Date(h.createdAt).getTime())?new Date(h.createdAt).toISOString():B,Ce=typeof h.updatedAt=="string"&&!Number.isNaN(new Date(h.updatedAt).getTime())?new Date(h.updatedAt).toISOString():J,ke=Number(h.salary)||0,Pe=typeof h.baseSalary=="number"?h.baseSalary:ke,ie=h.taiKhoan??h.account??"",le=h.matKhau??h.password??"";return{id:h.id??`legacy-${K}`,code:h.code??"",name:h.name??"",dept:h.dept??D?.tenPhong??"",departmentId:h.departmentId??D?.id??null,position:h.position??H?.tenChucVu??"",positionId:h.positionId??H?.id??null,baseSalary:Pe,status:h.status??"active",visible:typeof h.visible=="boolean"?h.visible:!0,photo:h.photo,joinOrder:h.joinOrder,joinedAt:B,taiKhoan:ie,matKhau:le,account:ie,password:le,createdAt:J,updatedAt:Ce}})},[o,u]=l.useState(()=>{const t=localStorage.getItem("employeesData");if(t)try{const x=JSON.parse(t);return r(x)}catch(x){console.warn("KhÃ´ng Ä‘á»c Ä‘Æ°á»£c employeesData:",x)}const y=r(i);return localStorage.setItem("employeesData",JSON.stringify(y)),y}),[P,w]=l.useState(""),[j,v]=l.useState("all"),[d,S]=l.useState("all"),[N,g]=l.useState(!1),[C,a]=l.useState([]),[c,f]=l.useState(null),[k,n]=l.useState(null),[m,A]=l.useState(null),[V,L]=l.useState(null),[G,de]=l.useState(!1),[Y,z]=l.useState(1);l.useEffect(()=>{$e.list(),qe.list()},[]),l.useEffect(()=>{let t=!0;return(async()=>{try{const x=await F.list();t&&x.length&&u(r(x))}catch(x){console.warn("KhÃ´ng thá»ƒ Ä‘á»“ng bá»™ danh sÃ¡ch nhÃ¢n viÃªn tá»« backend.",x)}})(),()=>{t=!1}},[]);const _=l.useMemo(()=>{const t=o.filter(y=>!(j!=="all"&&y.dept!==j||d!=="all"&&y.status!==d||P&&!y.name.toLowerCase().includes(P.toLowerCase())));return G?t:t.filter(y=>y.visible)},[o,P,j,d,G]);l.useEffect(()=>{const t=Math.max(1,Math.ceil(_.length/b));z(y=>Math.min(y,t))},[_.length]);const he=l.useMemo(()=>{const t=(Y-1)*b;return _.slice(t,t+b)},[_,Y]),ue=t=>{z(1),w(t)},me=t=>{z(1),v(t)},xe=t=>{z(1),S(t)},ae=l.useMemo(()=>De(o),[o]),ge=async t=>{try{const E=await F.create(t);if(E){u(O=>[E,...O]),q("ÄÃ£ thÃªm nhÃ¢n viÃªn"),g(!1);return}}catch(E){console.warn("KhÃ´ng thá»ƒ thÃªm nhÃ¢n viÃªn trÃªn backend, dÃ¹ng cháº¿ Ä‘á»™ offline.",E)}const y=Z(),x=W(),I=ae,h=Q({deptName:t.dept,positionName:t.position,joinOrder:I,departments:y,positions:x}),K=new Date().toISOString(),M=t.departmentId??y.find(E=>E.tenPhong===t.dept)?.id??null,D=t.positionId??x.find(E=>E.tenChucVu===t.position)?.id??null,H={...t,id:re(),code:h,departmentId:M,positionId:D,baseSalary:t.baseSalary,joinOrder:I,joinedAt:new Date(t.joinedAt).toISOString(),visible:!0,account:t.taiKhoan,password:t.matKhau,createdAt:K,updatedAt:K};u(E=>{const O=[H,...E];return F.saveLocalSnapshot(O),O}),q("ÄÃ£ thÃªm nhÃ¢n viÃªn (chá»‰ lÆ°u cá»¥c bá»™)"),g(!1)},pe=async t=>{if(!c)return;try{const K=await F.update(c.id,t);if(K){u(M=>M.map(D=>D.id===K.id?K:D)),q("ÄÃ£ cáº­p nháº­t nhÃ¢n viÃªn"),f(null);return}}catch(K){console.warn("KhÃ´ng thá»ƒ cáº­p nháº­t nhÃ¢n viÃªn trÃªn backend, dÃ¹ng dá»¯ liá»‡u offline.",K)}const y=Z(),x=W(),I=c.joinOrder??o.find(K=>K.id===c.id)?.joinOrder??1,h=t.dept!==c.dept||t.position!==c.position;u(K=>{const M=K.map(D=>{if(D.id!==c.id)return D;const H=h?Q({deptName:t.dept,positionName:t.position,joinOrder:I,departments:y,positions:x}):D.code,E=t.departmentId??y.find(J=>J.tenPhong===t.dept)?.id??D.departmentId??null,O=t.positionId??x.find(J=>J.tenChucVu===t.position)?.id??D.positionId??null,B=t.matKhau||D.matKhau;return{...D,code:H,name:t.name,dept:t.dept,departmentId:E,position:t.position,positionId:O,baseSalary:t.baseSalary,status:t.status,taiKhoan:t.taiKhoan,matKhau:B,account:t.taiKhoan,password:B,photo:t.photo??D.photo,joinedAt:new Date(t.joinedAt).toISOString(),joinOrder:I,updatedAt:new Date().toISOString()}});return F.saveLocalSnapshot(M),M}),q("ÄÃ£ cáº­p nháº­t nhÃ¢n viÃªn (chá»‰ lÆ°u cá»¥c bá»™)"),f(null)},be=async t=>{if(!window.confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xoÃ¡ nhÃ¢n viÃªn nÃ y?"))return;u(I=>{const h=I.filter(K=>K.id!==t);return F.saveLocalSnapshot(h),h});const x=await F.remove(t);q(x?"ÄÃ£ xÃ³a nhÃ¢n viÃªn":"ÄÃ£ xÃ³a nhÃ¢n viÃªn (chá»‰ trÃªn thiáº¿t bá»‹ nÃ y)")},q=t=>{const y=re();a(x=>[...x,{id:y,message:t}]),setTimeout(()=>{a(x=>x.filter(I=>I.id!==y))},3e3)},fe=t=>{f(t)},je=t=>{A(t)},ve=t=>{n(t)},ye=t=>{L(t)},Ne=t=>{u(y=>{const x=y.map(I=>I.id===t?{...I,visible:!I.visible}:I);return F.saveLocalSnapshot(x),x}),q("ÄÃ£ cáº­p nháº­t tráº¡ng thÃ¡i hiá»ƒn thá»‹ nhÃ¢n viÃªn")},we=t=>{const y=localStorage.getItem(`workingHours:${t}`);if(!y)return"0";try{const x=JSON.parse(y),I=new Date;if(x&&x.year===I.getFullYear()&&x.month===I.getMonth()+1&&typeof x.hours=="number")return String(x.hours)}catch(x){console.warn("KhÃ´ng Ä‘á»c Ä‘Æ°á»£c dá»¯ liá»‡u workingHours:",x)}return"0"},Se=async t=>{const y=new Date,x=y.getFullYear(),I=y.getMonth()+1;let h=we(t.id),K=t.baseSalary;try{const H=(await Re.fetchMonthlyPayrolls(t.id,x)).find(E=>E.month===I);H&&(h=String(H.total_hours??0),K=H.base_salary??K)}catch(D){console.warn("KhÃ´ng láº¥y Ä‘Æ°á»£c dá»¯ liá»‡u lÆ°Æ¡ng tá»« Supabase.",D)}const M=new URLSearchParams({employeeId:t.id,code:t.code,name:t.name,dept:t.dept,position:t.position,salary:String(K??0),hours:h});p(`/admin/payroll?${M.toString()}`)};return e.jsx("div",{className:"min-h-screen bg-white p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-sm font-medium cursor-pointer w-max hover:text-slate-700 transition",onClick:()=>p("/"),children:[e.jsx("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-white shadow-sm border border-slate-200",children:"â†"}),"Quay láº¡i"]}),e.jsxs("div",{className:"rounded-[32px] bg-white/90 p-8 shadow-[0_25px_60px_rgba(15,23,42,0.08)] border border-slate-100",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-500 uppercase tracking-wide",children:"Quáº£n trá»‹ nhÃ¢n sá»±"}),e.jsx("h1",{className:"mt-2 text-4xl font-bold text-slate-900",children:"NhÃ¢n viÃªn"}),e.jsx("p",{className:"mt-1 text-base text-slate-500",children:"Quáº£n lÃ½ danh sÃ¡ch vÃ  thÃ´ng tin nhÃ¢n sá»±"})]}),e.jsx("div",{className:"flex flex-col items-end gap-4",children:e.jsx(R,{className:"rounded-full px-5 py-2 text-base shadow-lg shadow-blue-200",onClick:()=>g(!0),children:"+ ThÃªm nhÃ¢n viÃªn"})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx(st,{q:P,onQueryChange:ue,dept:j,onDeptChange:me,status:d,onStatusChange:xe}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>de(t=>!t),className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 shadow-sm transition hover:border-blue-200 hover:bg-blue-50 hover:text-blue-600",children:G?"áº¨n danh sÃ¡ch bá»‹ áº©n":"Hiá»‡n cáº£ nhÃ¢n viÃªn Ä‘Ã£ áº©n"})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Qe,{data:he,totalCount:_.length,page:Y,pageSize:b,pageCount:Math.max(1,Math.ceil(_.length/b)),onPageChange:z,onDelete:t=>{be(t)},onEdit:fe,onRegisterFace:je,onViewPayroll:Se,onViewDetail:ve,onViewAttendance:ye,onToggleVisibility:Ne,showHidden:G})})]}),e.jsx("div",{className:"fixed bottom-4 right-4 space-y-2 z-50",children:C.map(t=>e.jsx("div",{className:"bg-gray-800 text-white py-2 px-4 rounded-lg shadow-lg animate-fade-in-out",children:t.message},t.id))}),e.jsx(Ze,{open:N,onClose:()=>g(!1),onSave:t=>{ge(t)},nextJoinOrder:ae}),e.jsx(tt,{open:!!c,onClose:()=>f(null),employee:c,onSave:t=>{pe(t)}}),e.jsx(nt,{open:!!k,onClose:()=>n(null),employee:k}),e.jsx(at,{open:!!m,onClose:()=>A(null),employee:m,onSaved:()=>{q("ÄÃ£ lÆ°u khuÃ´n máº·t nhÃ¢n viÃªn"),A(null)}}),e.jsx(it,{open:!!V,onClose:()=>L(null),employee:V})]})})}export{ut as default};
