import{c as m}from"./Modal-BUDUBpVK.js";import{s as o}from"./index-D0kGtGIa.js";const u=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],b=m("eye",u),h="departmentsData",s=e=>({id:e.id,maPhong:e.code,tenPhong:e.name,namThanhLap:e.founded_year??new Date().getFullYear(),trangThai:e.status,visible:!0}),c=e=>{const t={};return e.maPhong!==void 0&&(t.code=e.maPhong),e.tenPhong!==void 0&&(t.name=e.tenPhong),e.namThanhLap!==void 0&&(t.founded_year=e.namThanhLap),e.trangThai!==void 0&&(t.status=e.trangThai),t},g=()=>{if(typeof localStorage>"u")return[];const e=localStorage.getItem(h);if(!e)return[];try{return JSON.parse(e)}catch(t){return console.warn("Không thể đọc dữ liệu departmentsData:",t),[]}},i=e=>{typeof localStorage>"u"||localStorage.setItem(h,JSON.stringify(e))},d=(e=[])=>{const t=g();return t.length?t:(i(e),e)},l=(e,t)=>{const r=t.reduce((n,a)=>(n[a.id]=a.visible,n[a.maPhong]=a.visible,n),{});return e.map(n=>({...n,visible:r[n.id]??r[n.maPhong]??!0}))},v={loadLocal(e){return d(e)},saveLocal:i,createLocalRecord(e,t){return{id:t(),maPhong:e.maPhong,tenPhong:e.tenPhong,namThanhLap:e.namThanhLap,trangThai:e.trangThai,visible:!0}},async list(e){const t=d(e);try{const{data:r,error:n}=await o.from("departments").select("id, code, name, founded_year, status").order("name",{ascending:!0});if(n)throw n;const a=l((r??[]).map(s),t);return i(a),a}catch(r){return console.warn("Không thể tải danh sách phòng ban từ backend, sử dụng cache local.",r),t}},async create(e){const t=c(e),{data:r,error:n}=await o.from("departments").insert(t).select("id, code, name, founded_year, status").single();if(n||!r)throw n??new Error("Không thể tạo phòng ban.");return s(r)},async update(e,t){const r=c(t),{data:n,error:a}=await o.from("departments").update(r).eq("id",e).select("id, code, name, founded_year, status").single();if(a||!n)throw a??new Error("Không thể cập nhật phòng ban.");return s(n)},async remove(e){const{error:t}=await o.from("departments").delete().eq("id",e);if(t)throw t}};export{b as E,v as d};
