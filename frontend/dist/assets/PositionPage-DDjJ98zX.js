import{j as e,r as h,f as A,I as C,B as N}from"./index-nuNE0MbF.js";import{c as B,P as Z,T as U,M as O,v as F}from"./Modal-Bp8GA-AI.js";import{S as q}from"./Select-BSFxTWHW.js";import{E as W}from"./EmployeesListModal-C2IAxjGk.js";import{p as D}from"./positionsService-C7a9gh6_.js";const Y=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ee=B("shield-check",Y),te={ADMIN:"bg-red-100 text-red-600",MANAGER:"bg-purple-100 text-purple-600",STAFF:"bg-blue-100 text-blue-600",INTERN:"bg-emerald-100 text-emerald-600"};function ne({data:v,totalCount:m,page:x,pageSize:r,pageCount:i,onPageChange:u,onDelete:b,onEdit:g,onViewEmployees:f}){const p=m===0?0:(x-1)*r+1,y=m===0?0:Math.min(x*r,m);return e.jsxs("div",{className:"overflow-hidden rounded-[24px] border border-slate-100 shadow-[0_18px_45px_rgba(15,23,42,0.08)] bg-white",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"Chức vụ"}),e.jsx("th",{className:"px-6 py-4",children:"Mô tả & cấp độ"}),e.jsx("th",{className:"px-6 py-4",children:"Quyền hạn"}),e.jsx("th",{className:"px-6 py-4",children:"Nhân sự"}),e.jsx("th",{className:"px-6 py-4",children:"Trạng thái"}),e.jsx("th",{className:"px-6 py-4",children:"Hành động"})]})}),e.jsxs("tbody",{className:"bg-white text-sm text-slate-700",children:[v.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-10 text-center text-slate-400",children:"Không có chức vụ nào phù hợp"})}),v.map(n=>e.jsxs("tr",{className:"border-b border-slate-100 last:border-b-0 hover:bg-slate-50/70",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-gradient-to-br from-indigo-100 to-indigo-50 text-indigo-600 shadow-inner",children:e.jsx(ee,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:n.tenChucVu}),e.jsx("p",{className:"text-xs text-slate-500",children:n.maChucVu})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-sm text-slate-700",children:n.moTa||"Mô tả đang cập nhật"}),n.capDo&&e.jsx("span",{className:`mt-2 inline-flex items-center px-3 py-1 text-xs font-semibold rounded-full ${te[n.capDo]||"bg-slate-100 text-slate-600"}`,children:n.capDo})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:n.quyenHan?.length?n.quyenHan.map(s=>e.jsx("span",{className:"inline-flex items-center rounded-full border border-slate-200 px-3 py-1 text-xs text-slate-600",children:s},s)):e.jsx("span",{className:"text-xs text-slate-400",children:"Chưa gán quyền"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{type:"button",title:"Xem nhân sự theo chức vụ",onClick:()=>f?.(n),className:"flex items-center gap-3 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 shadow-sm transition hover:border-blue-200 hover:bg-blue-50 hover:text-blue-600",children:[e.jsx("div",{className:"flex -space-x-2",children:[...Array(3)].map((s,d)=>e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full border border-white bg-slate-100 text-xs font-semibold text-slate-500",children:n.tenChucVu.charAt(0)},d))}),e.jsxs("span",{children:[n.soNhanSu??0," người"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full px-4 py-1 text-xs font-semibold ${n.trangThai==="active"?"bg-green-50 text-green-600":"bg-slate-100 text-slate-500"}`,children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-current"}),n.trangThai==="active"?"Hoạt động":"Ngưng"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{title:"Sửa",onClick:()=>g?.(n),className:"rounded-full border border-blue-100 bg-blue-50 p-2 text-blue-600 shadow-sm transition hover:bg-blue-100",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{title:"Xoá",onClick:()=>b(n.id),className:"rounded-full border border-red-100 bg-red-50 p-2 text-red-500 shadow-sm transition hover:bg-red-100",children:e.jsx(U,{className:"h-4 w-4"})})]})})]},n.id))]})]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 border-t border-slate-100 bg-white px-6 py-4 text-sm text-slate-500",children:[e.jsxs("p",{children:["Hiển thị ",m===0?0:p,"-",y," trong ",m," chức vụ"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:bg-slate-50 disabled:opacity-40",disabled:x===1,onClick:()=>u(Math.max(1,x-1)),children:"←"}),Array.from({length:i},(n,s)=>e.jsx("button",{onClick:()=>u(s+1),className:`rounded-full px-3 py-1 ${x===s+1?"bg-blue-600 text-white shadow-md":"border border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:s+1},s)),e.jsx("button",{className:"rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:bg-slate-50 disabled:opacity-40",disabled:x===i,onClick:()=>u(Math.min(i,x+1)),children:"→"})]})]})]})}const se=[{label:"Admin",value:"ADMIN"},{label:"Manager",value:"MANAGER"},{label:"Staff",value:"STAFF"},{label:"Intern",value:"INTERN"}];function ae({open:v,onClose:m,onSave:x}){const[r,i]=h.useState({maChucVu:"",tenChucVu:"",moTa:"",capDo:"STAFF",quyenHan:[],trangThai:"active"}),[u,b]=h.useState("");h.useEffect(()=>{v&&(i({maChucVu:"",tenChucVu:"",moTa:"",capDo:"STAFF",quyenHan:[],trangThai:"active"}),b(""))},[v]),h.useEffect(()=>{i(n=>{const s=A(n.tenChucVu);return n.maChucVu===s?n:{...n,maChucVu:s}})},[r.tenChucVu]);const g=n=>{const{name:s,value:d}=n.target;i(j=>({...j,[s]:d}))},f=()=>{u.trim()&&(i(n=>({...n,quyenHan:[...n.quyenHan,u.trim()]})),b(""))},p=n=>{i(s=>({...s,quyenHan:s.quyenHan.filter(d=>d!==n)}))},y=n=>{if(n.preventDefault(),!r.tenChucVu){alert("Vui lòng nhập Tên chức vụ.");return}if(!r.maChucVu){alert("Không thể tạo mã chức vụ. Vui lòng kiểm tra lại tên chức vụ.");return}x(r)};return e.jsx(O,{open:v,onClose:m,title:"Thêm chức vụ",children:e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"Thông tin cơ bản"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Mã chức vụ"}),e.jsx(C,{name:"maChucVu",value:r.maChucVu,readOnly:!0,className:"bg-slate-50",placeholder:"Sẽ tự động tạo theo tên chức vụ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Tên chức vụ"}),e.jsx(C,{name:"tenChucVu",value:r.tenChucVu,onChange:g,placeholder:"VD: Trưởng phòng",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"Mô tả & cấp độ"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Mô tả công việc"}),e.jsx("textarea",{name:"moTa",value:r.moTa,onChange:g,className:"w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Mô tả ngắn về nhiệm vụ của chức vụ này..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Cấp độ"}),e.jsx(q,{name:"capDo",value:r.capDo,onChange:g,className:"rounded-2xl border-slate-200 bg-white py-3 text-sm text-slate-600",children:se.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"Quyền hạn"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:u,onChange:n=>b(n.target.value),placeholder:"VD: Thêm nhân viên"}),e.jsx(N,{type:"button",onClick:f,children:"Thêm"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.quyenHan.length>0?r.quyenHan.map(n=>e.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-sm text-slate-700",children:[n,e.jsx("button",{type:"button",className:"ml-2 text-xs text-slate-500 hover:text-slate-700",onClick:()=>p(n),children:"✕"})]},n)):e.jsx("p",{className:"text-xs text-slate-400",children:'Chưa thêm quyền hạn nào. Nhập quyền hạn và nhấn "Thêm".'})})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"Trạng thái"}),e.jsxs(q,{name:"trangThai",value:r.trangThai,onChange:g,className:"rounded-2xl border-slate-200 bg-white py-3 text-sm text-slate-600",children:[e.jsx("option",{value:"active",children:"Hoạt động"}),e.jsx("option",{value:"inactive",children:"Ngưng"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(N,{variant:"ghost",type:"button",onClick:m,children:"Huỷ"}),e.jsx(N,{type:"submit",children:"Lưu"})]})]})})}const le=[{label:"Admin",value:"ADMIN"},{label:"Manager",value:"MANAGER"},{label:"Staff",value:"STAFF"},{label:"Intern",value:"INTERN"}];function ce({open:v,onClose:m,onSave:x,position:r}){const[i,u]=h.useState({maChucVu:"",tenChucVu:"",moTa:"",capDo:"STAFF",quyenHan:[],trangThai:"active"}),[b,g]=h.useState("");h.useEffect(()=>{r&&(u({maChucVu:r.maChucVu,tenChucVu:r.tenChucVu,moTa:r.moTa??"",capDo:r.capDo??"STAFF",quyenHan:Array.isArray(r.quyenHan)?r.quyenHan:[],trangThai:r.trangThai}),g(""))},[r]),h.useEffect(()=>{u(s=>{const d=A(s.tenChucVu);return s.maChucVu===d?s:{...s,maChucVu:d}})},[i.tenChucVu]);const f=s=>{const{name:d,value:j}=s.target;u(w=>({...w,[d]:j}))},p=()=>{b.trim()&&(u(s=>({...s,quyenHan:[...s.quyenHan,b.trim()]})),g(""))},y=s=>{u(d=>({...d,quyenHan:d.quyenHan.filter(j=>j!==s)}))},n=s=>{if(s.preventDefault(),!i.tenChucVu)return alert("Tên chức vụ không được để trống");if(!i.maChucVu)return alert("Không thể tạo mã chức vụ. Vui lòng kiểm tra lại tên.");x(i)};return r?e.jsx(O,{open:v,onClose:m,title:"Chỉnh sửa chức vụ",children:e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Mã chức vụ"}),e.jsx(C,{name:"maChucVu",value:i.maChucVu,readOnly:!0,className:"bg-slate-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Tên chức vụ"}),e.jsx(C,{name:"tenChucVu",value:i.tenChucVu,onChange:f,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Mô tả công việc"}),e.jsx("textarea",{name:"moTa",value:i.moTa,onChange:f,rows:3,className:"w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Cập nhật mô tả trách nhiệm của chức vụ"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Cấp độ"}),e.jsx(q,{name:"capDo",value:i.capDo,onChange:f,children:le.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Trạng thái"}),e.jsxs(q,{name:"trangThai",value:i.trangThai,onChange:f,children:[e.jsx("option",{value:"active",children:"Hoạt động"}),e.jsx("option",{value:"inactive",children:"Ngưng"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Quyền hạn"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:b,onChange:s=>g(s.target.value),placeholder:"VD: Duyệt chấm công"}),e.jsx(N,{type:"button",onClick:p,children:"Thêm"})]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:i.quyenHan.length?i.quyenHan.map(s=>e.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-700",children:[s,e.jsx("button",{type:"button",className:"ml-2 text-slate-500 hover:text-slate-700",onClick:()=>y(s),children:"✕"})]},s)):e.jsx("span",{className:"text-xs text-slate-400",children:"Chưa có quyền hạn nào"})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(N,{variant:"ghost",type:"button",onClick:m,children:"Huỷ"}),e.jsx(N,{type:"submit",children:"Lưu thay đổi"})]})]})}):null}function de(){const v=[{id:"1",maChucVu:"G",tenChucVu:"Giám đốc điều hành",moTa:"Quản lý toàn bộ hoạt động công ty",capDo:"ADMIN",quyenHan:["Toàn quyền hệ thống","Duyệt ngân sách"],trangThai:"active",visible:!0},{id:"2",maChucVu:"T",tenChucVu:"Trưởng phòng",moTa:"Quản lý nhân sự và KPI phòng ban",capDo:"MANAGER",quyenHan:["Quản lý nhân viên","Duyệt công","Xem báo cáo"],trangThai:"active",visible:!0},{id:"3",maChucVu:"N",tenChucVu:"Chuyên viên nhân sự",moTa:"Quản lý hồ sơ và tuyển dụng",capDo:"STAFF",quyenHan:["Thêm nhân viên","Cập nhật hồ sơ"],trangThai:"active",visible:!0}],[m,x]=h.useState(()=>{const t=localStorage.getItem("positionsData");if(t)try{return JSON.parse(t)}catch(a){console.warn("Không đọc được positionsData:",a)}return localStorage.setItem("positionsData",JSON.stringify(v)),v}),[r,i]=h.useState(""),[u,b]=h.useState(!1),[g,f]=h.useState([]),[p,y]=h.useState(null),[n,s]=h.useState(1),[d,j]=h.useState({}),[w,k]=h.useState([]),[H,P]=h.useState(null),[L,I]=h.useState(!1),S=4,T=t=>{x(a=>{const c=t(a);return localStorage.setItem("positionsData",JSON.stringify(c)),c})},K=(t,a)=>{const c=a.reduce((l,o)=>(l[o.id]=o,l[o.maChucVu]=o,l),{});return t.map(l=>{const o=c[l.id]??c[l.maChucVu];return{id:l.id,maChucVu:l.maChucVu,tenChucVu:l.tenChucVu,moTa:l.moTa??o?.moTa??"",capDo:o?.capDo??"STAFF",quyenHan:o?.quyenHan??[],trangThai:o?.trangThai??"active",visible:l.visible,soNhanSu:o?.soNhanSu??0}})},E=h.useMemo(()=>{const t=m.filter(c=>!(r&&!(c.tenChucVu.toLowerCase().includes(r.toLowerCase())||c.maChucVu.toLowerCase().includes(r.toLowerCase())))),a=Math.max(1,Math.ceil(t.length/S));return n>a&&s(a),t},[m,r]);h.useEffect(()=>{const t=()=>{try{const a=localStorage.getItem("employeesData");if(!a){j({});return}const l=JSON.parse(a).reduce((o,V)=>(o[V.position]=(o[V.position]||0)+1,o),{});j(l)}catch(a){console.warn("Không đọc được employeesData:",a),j({})}};return t(),window.addEventListener("storage",t),window.addEventListener("focus",t),()=>{window.removeEventListener("storage",t),window.removeEventListener("focus",t)}},[]),h.useEffect(()=>{let t=!0;return(async()=>{try{const c=await D.list();if(!t||!c.length)return;T(l=>K(c,l))}catch(c){console.warn("Không thể đồng bộ chức vụ từ Supabase:",c)}})(),()=>{t=!1}},[]);const R=t=>A(t)||"X",_=async t=>{const a=t.maChucVu||R(t.tenChucVu),c={capDo:t.capDo,quyenHan:t.quyenHan,trangThai:t.trangThai,soNhanSu:0};try{const l=await D.create({maChucVu:a,tenChucVu:t.tenChucVu,moTa:t.moTa}),o={id:l.id,maChucVu:l.maChucVu,tenChucVu:l.tenChucVu,moTa:l.moTa??t.moTa,visible:l.visible,...c};T(V=>[o,...V.filter(X=>X.id!==o.id)])}catch(l){console.warn("Không thể lưu chức vụ lên Supabase, dùng dữ liệu local.",l);const o={id:F(),maChucVu:a,tenChucVu:t.tenChucVu,moTa:t.moTa,visible:!0,...c};T(V=>[o,...V])}M("Đã thêm chức vụ"),b(!1)},Q=async t=>{if(p){T(a=>a.map(c=>c.id===p.id?{...c,maChucVu:t.maChucVu,tenChucVu:t.tenChucVu,moTa:t.moTa,capDo:t.capDo,quyenHan:[...t.quyenHan],trangThai:t.trangThai}:c));try{const a=await D.update(p.id,{maChucVu:t.maChucVu,tenChucVu:t.tenChucVu,moTa:t.moTa});T(c=>c.map(l=>l.id===p.id?{...l,maChucVu:a.maChucVu,tenChucVu:a.tenChucVu,moTa:a.moTa??t.moTa,visible:a.visible,capDo:t.capDo,quyenHan:[...t.quyenHan],trangThai:t.trangThai}:l))}catch(a){console.warn("Không thể cập nhật chức vụ trên Supabase.",a)}M("Đã cập nhật chức vụ"),y(null)}},G=async t=>{if(window.confirm("Bạn có chắc chắn muốn xoá chức vụ này?")){T(c=>c.filter(l=>l.id!==t));try{await D.remove(t)}catch(c){console.warn("Không thể xóa chức vụ trên Supabase.",c)}M("Đã xóa chức vụ")}},M=t=>{const a=F();f(c=>[...c,{id:a,message:t}]),setTimeout(()=>{f(c=>c.filter(l=>l.id!==a))},3e3)},$=t=>{y(t)},z=t=>{P(t);try{const a=localStorage.getItem("employeesData");if(!a)k([]);else{const l=JSON.parse(a).filter(o=>o.position===t.tenChucVu);k(l)}}catch(a){console.warn("Không đọc được employeesData:",a),k([])}I(!0)},J=()=>{I(!1),k([]),P(null)};return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"Chức vụ"}),e.jsx(N,{onClick:()=>b(!0),children:"+ Thêm chức vụ"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:e.jsx("div",{className:"md:col-span-2",children:e.jsx(C,{placeholder:"Tìm theo tên, mã chức vụ...",value:r,onChange:t=>i(t.target.value)})})}),e.jsx(ne,{data:E.slice((n-1)*S,n*S).map(t=>({...t,soNhanSu:d[t.tenChucVu]||0})),totalCount:E.length,page:n,pageSize:S,pageCount:Math.max(1,Math.ceil(E.length/S)),onPageChange:s,onDelete:G,onEdit:$,onViewEmployees:z}),e.jsx("div",{className:"fixed bottom-4 right-4 space-y-2 z-50",children:g.map(t=>e.jsx("div",{className:"bg-gray-800 text-white py-2 px-4 rounded-lg shadow-lg animate-fade-in-out",children:t.message},t.id))}),e.jsx(W,{open:L,onClose:J,title:H?`Nhân sự - ${H.tenChucVu}`:"Nhân sự theo chức vụ",employees:w,description:w.length?`Có ${w.length} nhân viên giữ chức vụ ${H?.tenChucVu??""}.`:void 0,emptyDescription:"Chưa có nhân viên nào giữ chức vụ này."}),e.jsx(ae,{open:u,onClose:()=>b(!1),onSave:_}),e.jsx(ce,{open:!!p,onClose:()=>y(null),position:p,onSave:Q})]})})}export{de as default};
