import{j as e,r as c,d as E,I as P,B as S}from"./index-nuNE0MbF.js";import{P as U,T as X,M as _,v as $}from"./Modal-Bp8GA-AI.js";import{S as A}from"./Select-BSFxTWHW.js";import{E as z}from"./EmployeesListModal-C2IAxjGk.js";import{d as N}from"./departmentsService-CwK6u15h.js";const q=["bg-indigo-100 text-indigo-600","bg-sky-100 text-sky-600","bg-emerald-100 text-emerald-600","bg-violet-100 text-violet-600","bg-amber-100 text-amber-600"],Q=g=>g?g.split(" ").map(o=>o.charAt(0)).join("").slice(0,2).toUpperCase():"?",W=(g,o)=>{if(o<=5)return Array.from({length:o},(x,b)=>b+1);const r=[1];let a=Math.max(2,g-1),i=Math.min(o-1,g+1);a>2&&r.push("dots-start");for(let x=a;x<=i;x+=1)r.push(x);return i<o-1&&r.push("dots-end"),r.push(o),r};function Z({data:g,totalCount:o,page:r,pageSize:a,pageCount:i,onPageChange:x,onDelete:b,onEdit:d,onViewEmployees:h}){const m=g,j=o===0?0:(r-1)*a+1,v=o===0?0:Math.min(r*a,o),y=W(r,i);return g.reduce((t,f)=>(typeof f.nhanSu=="number"&&(t[f.id]=f.nhanSu),t),{}),e.jsxs("div",{className:"overflow-hidden rounded-[24px] border border-slate-100 shadow-[0_18px_45px_rgba(15,23,42,0.08)] bg-white",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100 text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-500",children:e.jsx("tr",{children:["MÃ£ phÃ²ng","TÃªn phÃ²ng","TrÆ°á»Ÿng phÃ²ng","NÄƒm thÃ nh láº­p","NhÃ¢n sá»±","Tráº¡ng thÃ¡i","HÃ nh Ä‘á»™ng"].map(t=>e.jsx("th",{className:"px-6 py-4",children:t},t))})}),e.jsxs("tbody",{className:"bg-white text-sm text-slate-700",children:[m.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-8 text-center text-slate-400",children:"KhÃ´ng cÃ³ phÃ²ng ban nÃ o phÃ¹ há»£p vá»›i bá»™ lá»c"})}),m.map((t,f)=>e.jsxs("tr",{className:"border-b border-slate-100 last:border-b-0 hover:bg-slate-50/70",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"rounded-full bg-violet-100 px-3 py-1 text-xs font-semibold text-violet-600",children:t.maPhong})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-slate-100 text-slate-500",children:"ðŸ¢"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:t.tenPhong}),e.jsx("p",{className:"text-xs text-slate-500",children:"PhÃ²ng ban"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex h-9 w-9 items-center justify-center rounded-full text-sm font-semibold ${q[f%q.length]}`,children:Q(t.truongPhong||t.tenPhong)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:t.truongPhong||"ChÆ°a phÃ¢n cÃ´ng"}),e.jsx("p",{className:"text-xs text-slate-500",children:"TrÆ°á»Ÿng phÃ²ng"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-slate-700",children:t.namThanhLap}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{type:"button",title:"Xem danh sÃ¡ch nhÃ¢n sá»±",onClick:()=>h?.(t),className:"flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 shadow-sm transition hover:border-blue-200 hover:bg-blue-50 hover:text-blue-600",children:[e.jsx("div",{className:"flex -space-x-2",children:[0,1,2].map(C=>e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full border border-white bg-slate-100 text-slate-500",children:"ðŸ‘¤"},C))}),e.jsxs("span",{children:["+",t.nhanSu??0]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full px-4 py-1 text-xs font-semibold ${t.trangThai==="active"?"bg-green-50 text-green-600":"bg-slate-100 text-slate-500"}`,children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-current"}),t.trangThai==="active"?"Hoáº¡t Ä‘á»™ng":"NgÆ°ng"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{title:"Sá»­a",onClick:()=>d&&d(t),className:"rounded-full border border-blue-100 bg-blue-50 p-2 text-blue-600 shadow-sm transition hover:bg-blue-100",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx("button",{title:"XoÃ¡",onClick:()=>b(t.id),className:"rounded-full border border-red-100 bg-red-50 p-2 text-red-500 shadow-sm transition hover:bg-red-100",children:e.jsx(X,{className:"h-4 w-4"})})]})})]},t.id))]})]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 border-t border-slate-100 bg-white px-6 py-4 text-sm text-slate-500",children:[e.jsxs("p",{children:["Hiá»ƒn thá»‹ ",o===0?0:j,"-",v," trong"," ",o," káº¿t quáº£"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:bg-slate-50 disabled:opacity-40",disabled:r===1,onClick:()=>x(Math.max(1,r-1)),children:"â†"}),y.map((t,f)=>typeof t=="number"?e.jsx("button",{onClick:()=>x(t),className:`rounded-full px-3 py-1 ${t===r?"bg-blue-600 text-white shadow-md":"border border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:t},t):e.jsx("span",{className:"px-2",children:"..."},`${t}-${f}`)),e.jsx("button",{className:"rounded-full border border-slate-200 px-3 py-1 text-slate-600 transition hover:bg-slate-50 disabled:opacity-40",disabled:r===i,onClick:()=>x(Math.min(i,r+1)),children:"â†’"})]})]})]})}function ee({open:g,onClose:o,onSave:r}){const[a,i]=c.useState({maPhong:"",tenPhong:"",namThanhLap:new Date().getFullYear(),trangThai:"active"});c.useEffect(()=>{g&&i({maPhong:"",tenPhong:"",namThanhLap:new Date().getFullYear(),trangThai:"active"})},[g]);const x=d=>{const{name:h,value:m}=d.target;i(j=>({...j,[h]:h==="namThanhLap"?parseInt(m,10)||0:m}))};c.useEffect(()=>{i(d=>{if(!d.tenPhong)return d.maPhong?{...d,maPhong:""}:d;const h=E(d.tenPhong);return h&&d.maPhong!==h?{...d,maPhong:h}:d})},[a.tenPhong]);const b=d=>{if(d.preventDefault(),!a.tenPhong){alert("Vui lÃ²ng nháº­p TÃªn phÃ²ng.");return}if(!a.maPhong){alert("KhÃ´ng thá»ƒ táº¡o mÃ£ phÃ²ng ban. Vui lÃ²ng kiá»ƒm tra tÃªn phÃ²ng.");return}r(a)};return e.jsx(_,{open:g,onClose:o,title:"ThÃªm phÃ²ng ban",children:e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"ThÃ´ng tin cÆ¡ báº£n"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"MÃ£ phÃ²ng ban"}),e.jsx(P,{name:"maPhong",value:a.maPhong,readOnly:!0,className:"bg-slate-50",placeholder:"Sáº½ tá»± táº¡o tá»« tÃªn phÃ²ng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"TÃªn phÃ²ng ban"}),e.jsx(P,{name:"tenPhong",value:a.tenPhong,onChange:x,placeholder:"VD: PhÃ²ng Kinh Doanh",required:!0})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-blue-500 mb-3",children:"ThÃ´ng tin váº­n hÃ nh"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"NÄƒm thÃ nh láº­p"}),e.jsx(P,{name:"namThanhLap",type:"number",value:a.namThanhLap,onChange:x,placeholder:"VD: 2023",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Tráº¡ng thÃ¡i"}),e.jsxs(A,{name:"trangThai",value:a.trangThai,onChange:x,children:[e.jsx("option",{value:"active",children:"Hoáº¡t Ä‘á»™ng"}),e.jsx("option",{value:"inactive",children:"NgÆ°ng"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(S,{variant:"ghost",type:"button",onClick:o,children:"Huá»·"}),e.jsx(S,{type:"submit",children:"LÆ°u"})]})]})})}function ne({open:g,onClose:o,onSave:r,department:a}){const[i,x]=c.useState({maPhong:"",tenPhong:"",namThanhLap:new Date().getFullYear(),trangThai:"active"});c.useEffect(()=>{a&&x({maPhong:a.maPhong,tenPhong:a.tenPhong,namThanhLap:a.namThanhLap,trangThai:a.trangThai})},[a]),c.useEffect(()=>{x(h=>{if(!h.tenPhong)return h;const m=E(h.tenPhong);return m&&h.maPhong!==m?{...h,maPhong:m}:h})},[i.tenPhong]);const b=h=>{const{name:m,value:j}=h.target;x(v=>({...v,[m]:m==="namThanhLap"?parseInt(j,10)||0:j}))},d=h=>{if(h.preventDefault(),!i.tenPhong){alert("TÃªn phÃ²ng khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng");return}if(!i.maPhong){alert("KhÃ´ng thá»ƒ táº¡o mÃ£ phÃ²ng ban.");return}r(i)};return a?e.jsx(_,{open:g,onClose:o,title:"Chá»‰nh sá»­a phÃ²ng ban",children:e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"MÃ£ phÃ²ng"}),e.jsx(P,{name:"maPhong",value:i.maPhong,readOnly:!0,className:"bg-slate-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"TÃªn phÃ²ng"}),e.jsx(P,{name:"tenPhong",value:i.tenPhong,onChange:b,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"NÄƒm thÃ nh láº­p"}),e.jsx(P,{name:"namThanhLap",type:"number",value:i.namThanhLap,onChange:b,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-black mb-2",children:"Tráº¡ng thÃ¡i"}),e.jsxs(A,{name:"trangThai",value:i.trangThai,onChange:b,children:[e.jsx("option",{value:"active",children:"Hoáº¡t Ä‘á»™ng"}),e.jsx("option",{value:"inactive",children:"NgÆ°ng"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(S,{variant:"ghost",type:"button",onClick:o,children:"Huá»·"}),e.jsx(S,{type:"submit",children:"LÆ°u thay Ä‘á»•i"})]})]})}):null}function he(){const g=c.useMemo(()=>[{id:"1",maPhong:"PKD",tenPhong:"PhÃ²ng Kinh Doanh",namThanhLap:2020,trangThai:"active",visible:!0},{id:"2",maPhong:"PNS",tenPhong:"PhÃ²ng NhÃ¢n Sá»±",namThanhLap:2019,trangThai:"active",visible:!0},{id:"3",maPhong:"PKT",tenPhong:"PhÃ²ng Káº¿ ToÃ¡n",namThanhLap:2018,trangThai:"inactive",visible:!0}],[]),[o,r]=c.useState(()=>N.loadLocal(g)),[a,i]=c.useState(""),[x,b]=c.useState(!1),[d,h]=c.useState([]),[m,j]=c.useState(null),[v,y]=c.useState(1),[t,f]=c.useState({}),[C,I]=c.useState(!1),[B,L]=c.useState([]),[D,H]=c.useState(null),T=4,w=n=>{r(l=>{const s=n(l);return N.saveLocal(s),s})};c.useEffect(()=>{let n=!0;return(async()=>{try{const s=await N.list(g);n&&r(s)}catch(s){console.warn("KhÃ´ng thá»ƒ Ä‘á»“ng bá»™ phÃ²ng ban tá»« backend:",s)}})(),()=>{n=!1}},[g]),c.useEffect(()=>{const n=()=>{try{const l=localStorage.getItem("employeesData");if(!l){f({});return}const u=JSON.parse(l).reduce((p,k)=>(p[k.dept]=(p[k.dept]||0)+1,p),{});f(u)}catch(l){console.warn("KhÃ´ng Ä‘á»c Ä‘Æ°á»£c employeesData:",l),f({})}};return n(),window.addEventListener("storage",n),window.addEventListener("focus",n),()=>{window.removeEventListener("storage",n),window.removeEventListener("focus",n)}},[]);const M=c.useMemo(()=>{const n=o.filter(s=>!(a&&!(s.tenPhong.toLowerCase().includes(a.toLowerCase())||s.maPhong.toLowerCase().includes(a.toLowerCase())))),l=Math.max(1,Math.ceil(n.length/T));return v>l&&y(l),n},[o,a,v]),V=n=>E(n),O=async n=>{const l=n.maPhong||V(n.tenPhong),s={...n,maPhong:l};try{const u=await N.create(s);w(p=>[u,...p])}catch(u){console.warn("KhÃ´ng thá»ƒ táº¡o phÃ²ng ban qua API, lÆ°u local.",u);const p=N.createLocalRecord(s,$);w(k=>[p,...k])}K("ÄÃ£ thÃªm phÃ²ng ban"),b(!1)},F=async n=>{if(!m)return;const l={...n,maPhong:n.maPhong||V(n.tenPhong)};w(s=>s.map(u=>u.id===m.id?{...u,...l}:u));try{const s=await N.update(m.id,l);w(u=>u.map(p=>p.id===m.id?{...p,...s,visible:p.visible}:p))}catch(s){console.warn("KhÃ´ng thá»ƒ cáº­p nháº­t phÃ²ng ban qua API, giá»¯ dá»¯ liá»‡u local.",s)}K("ÄÃ£ cáº­p nháº­t phÃ²ng ban"),j(null)},R=async n=>{if(window.confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xoÃ¡ phÃ²ng ban nÃ y?")){w(s=>s.filter(u=>u.id!==n));try{await N.remove(n)}catch(s){console.warn("KhÃ´ng thá»ƒ xoÃ¡ phÃ²ng ban trÃªn backend, Ä‘Ã£ xoÃ¡ local.",s)}K("ÄÃ£ xÃ³a phÃ²ng ban")}},K=n=>{const l=$();h(s=>[...s,{id:l,noiDung:n}]),setTimeout(()=>{h(s=>s.filter(u=>u.id!==l))},3e3)},G=n=>{j(n)},Y=n=>{H(n);try{const l=localStorage.getItem("employeesData");if(!l)L([]);else{const u=JSON.parse(l).filter(p=>p.dept===n.tenPhong);L(u)}}catch(l){console.warn("KhÃ´ng Ä‘á»c Ä‘Æ°á»£c employeesData:",l),L([])}I(!0)},J=()=>{I(!1),L([]),H(null)};return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-gray-900",children:"PhÃ²ng ban"}),e.jsx(S,{onClick:()=>b(!0),children:"+ ThÃªm phÃ²ng ban"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:e.jsx("div",{className:"md:col-span-2",children:e.jsx(P,{placeholder:"TÃ¬m theo tÃªn, mÃ£ phÃ²ng...",value:a,onChange:n=>{y(1),i(n.target.value)}})})}),e.jsx(Z,{data:M.slice((v-1)*T,v*T).map(n=>({...n,nhanSu:t[n.tenPhong]||0})),totalCount:M.length,page:v,pageSize:T,pageCount:Math.max(1,Math.ceil(M.length/T)),onPageChange:y,onDelete:R,onEdit:G,onViewEmployees:Y}),e.jsx("div",{className:"fixed bottom-4 right-4 space-y-2 z-50",children:d.map(n=>e.jsx("div",{className:"bg-gray-800 text-white py-2 px-4 rounded-lg shadow-lg animate-fade-in-out",children:n.noiDung},n.id))}),e.jsx(z,{open:C,onClose:J,title:D?`NhÃ¢n sá»± - ${D.tenPhong}`:"NhÃ¢n sá»± phÃ²ng ban",employees:B,description:B.length?`CÃ³ ${B.length} nhÃ¢n viÃªn thuá»™c ${D?.tenPhong??"phÃ²ng ban"}.`:void 0,emptyDescription:"ChÆ°a cÃ³ nhÃ¢n viÃªn nÃ o trong phÃ²ng ban nÃ y."}),e.jsx(ee,{open:x,onClose:()=>b(!1),onSave:O}),e.jsx(ne,{open:!!m,onClose:()=>j(null),department:m,onSave:F})]})})}export{he as default};
